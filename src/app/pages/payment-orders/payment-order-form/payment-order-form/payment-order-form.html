<p-toast></p-toast>

<p-card [header]="'Create Payment Order'">
  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="payment-order-form">

    <div class="field">
      <label class="title">Reference *</label>
      <input pInputText formControlName="reference" />
      @if (f['reference'].touched && f['reference'].invalid) {
        <small class="error-message">Reference is required.</small>
      }
      @if (duplicateRef()) {
        <small class="error-message">
          Reference "{{ f['reference'].value }}" is already used.<br />
          Would you like to use
          <a href="#" (click)="useSuggestedRef(); $event.preventDefault()"> {{ suggestedRef() }} </a>
          instead?
        </small>
      }
    </div>

    <div class="field">
      <label class="title">Title *</label>
      <input pInputText formControlName="title" />
      @if (f['title'].touched && f['title'].invalid) {
        <small class="error-message">Title is required.</small>
      }
    </div>

    <div class="field">
      <label class="title">Description</label>
      <input pInputText formControlName="description" />
    </div>

    <div class="field">
      <label class="title">Amount *</label>
      <p-inputNumber formControlName="amount" mode="decimal" [min]="0.01"></p-inputNumber>
      @if (f['amount'].touched && f['amount'].invalid) {
        <small class="error-message">Amount must be greater than 0.</small>
      }
    </div>

    <div class="field">
      <label class="title">Currency *</label>
      <input pInputText formControlName="currency" />
    </div>

    <div class="field">
      <label class="title">Status *</label>
      <p-select formControlName="status" [options]="statuses" placeholder="Select status"></p-select>
    </div>

    @if (form.get('status')?.value === 'Successful') {
      <div class="field">
        <label class="title">Paid On</label>
        <input type="datetime-local" pInputText formControlName="paidOn" />
      </div>

      <div class="field">
        <label class="title">Authorization Code</label>
        <input pInputText formControlName="authorizationCode" placeholder="Enter authorization code" />
      </div>
    }

    <div class="field">
      <label class="title">Customer *</label>
      <div class="radio-group">
        <p-radioButton name="mode" inputId="manual" value="manual" formControlName="customerMode" />
        <label for="manual">Manual Entry</label>
        <p-radioButton name="mode" inputId="existing" value="existing" formControlName="customerMode" />
        <label for="existing">Use Existing</label>
      </div>
    </div>

    @if (customerMode() === 'existing') {
      <div class="field">
        <label class="title">Select Customer</label>
        <p-select
          formControlName="customerSelect"
          [options]="customers()"
          optionLabel="email"
          placeholder="Choose a customer"
        ></p-select>
      </div>
    }

    <div formGroupName="customer" class="customer-section">
      <div class="field"><label class="title">First Name *</label><input pInputText formControlName="firstName" /></div>
      <div class="field"><label class="title">Last Name *</label><input pInputText formControlName="lastName" /></div>
      <div class="field"><label class="title">Email *</label><input pInputText formControlName="email" /></div>
      <div class="field"><label class="title">Phone</label><input pInputText formControlName="phone" /></div>
      <div class="field"><label class="title">Address</label><input pInputText formControlName="address" /></div>
      <div class="field"><label class="title">City</label><input pInputText formControlName="city" /></div>
      <div class="field"><label class="title">Postal Code</label><input pInputText formControlName="postalCode" /></div>
      <div class="field"><label class="title">Country</label><input pInputText formControlName="country" /></div>
    </div>

    <div class="button-group">
      <button pButton type="button" label="Cancel" class="p-button-secondary" (click)="onCancel()"></button>
      <button pButton type="submit" label="Save" [disabled]="form.invalid || duplicateRef()"></button>
    </div>

  </form>
</p-card>