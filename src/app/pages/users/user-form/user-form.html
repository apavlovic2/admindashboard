<p-toast></p-toast>

<p-card [header]="editMode ? 'Edit User' : 'Create User'">
  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="user-form">
    
    <div class="field">
      <label>First Name *</label>
      <input pInputText formControlName="firstName" />
      @if (f['firstName'].touched && f['firstName'].invalid) {
        <small class="error">
          First name is required (max 50 characters)
        </small>
      }
    </div>

    <div class="field">
      <label>Last Name *</label>
      <input pInputText formControlName="lastName" />
      @if (f['lastName'].touched && f['lastName'].invalid) {
        <small class="error">
          Last name is required (max 50 characters)
        </small>
      }
    </div>

    <div class="field">
      <label>Email *</label>
      <input pInputText formControlName="email" />
      @if (f['email'].touched && f['email'].invalid) {
        <small class="error">
          Must be a valid email address (max 50 characters)
        </small>
      }
    </div>

    <div class="field">
      <label>Password {{ editMode ? '(optional)' : '*' }}</label>
      <div class="password-wrapper">
        <input
          pInputText
          [type]="showPassword() ? 'text' : 'password'"
          formControlName="password"
        />
        <button
          type="button"
          pButton
          icon="{{ showPassword() ? 'pi pi-eye-slash' : 'pi pi-eye' }}"
          class="p-button-text p-button-plain toggle-password-btn"
          (click)="togglePassword()"
        ></button>
      </div>

      @if (f['password'].touched && f['password'].errors) {
        <small class="error">
          @if (f['password'].errors['required']) {
            Password is required.
          }
          @if (f['password'].errors['minlength']) {
            Password must be at least 8 characters long.
          }
          @if (f['password'].errors['pattern']) {
            Must contain uppercase, lowercase, number, and special character.
          }
        </small>
      }
    </div>

    <div class="field">
      <label>Roles</label>
      <p-multiSelect
        [options]="roles"
        formControlName="roles"
        [showClear]="true"
        defaultLabel="Select roles"
      ></p-multiSelect>
    </div>

    <div class="form-actions">
      <button
        pButton
        type="button"
        label="Cancel"
        class="cancel-btn"
        (click)="onCancel()"
      ></button>
      <button
        pButton
        type="submit"
        label="Save"
        class="save-btn"
        [disabled]="form.invalid && !editMode"
      ></button>
    </div>
  </form>
</p-card>
